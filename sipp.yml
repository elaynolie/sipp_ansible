---
- name: Installing SIPp from source
  hosts: localhost
  become: yes
  tasks:

    - name: Install required dependencies
      apt:
        name:
          - cmake
          - build-essential
          - libncurses-dev
          - libpcap-dev
          - openssl
          - libssl-dev
        state: present
        update_cache: yes

    - name: Make sure the /usr/local/src directory exists
      file:
        path: /usr/local/src
        state: directory

    - name: Download the SIPp 3.7.5 (check valid url)
      get_url:
        url: https://github.com/SIPp/sipp/releases/download/v3.7.5/sipp-3.7.5.tar.gz
        dest: /usr/local/src/sipp-3.7.5.tar.gz
        mode: '0644'

    - name: Unzip the SIPp archive
      unarchive:
        src: /usr/local/src/sipp-3.7.5.tar.gz
        dest: /usr/local/src/
        remote_src: yes

    - name: Run compilation SIPp step 1
      command: cmake .
      args:
        chdir: /usr/local/src/sipp-3.7.5

    - name: Rum compolation SIPp step 2
      command: make
      args:
        chdir: /usr/local/src/sipp-3.7.5

    - name: Install SIPp
      command: make install
      args:
        chdir: /usr/local/src/sipp-3.7.5

